# Nest.js 

## Архитектура Nest.js

### Модули 

Модули - это по сути строительные блоки из которых состоит приложение. В обязательном у каждого приложения на Nest.js есть хотя бы один модуль - корневой модуль, который часто называется `appModule`. Рекомендуется разделять модули по доменным областям. 

[![image.jpg](https://i.postimg.cc/JzHQzxCS/image.jpg)](https://postimg.cc/VJ1t7j6F)

В маленьких микросервисах достаточно одного модуля, в больших же сервисах и монолитах может быть вложенность три. В реальности вложенность больше трёх редко бывает. Модули поддерживают чистоту приложения, её отделимость и возможность в любой момент отрефакторить и вынести что-то в отдельным микросервис. 

#### Модуль объеденяет зависимости одной доменной области

[![image.jpg](https://i.postimg.cc/Qd7p3Mp3/image.jpg)](https://postimg.cc/6897Vtjj)

Суммарно зависимости, которые скрывает за собой модуль это:
- импорты. Это другие модули, которые текущий модуль импортирует в себя.
- контроллеры. Это http или другие протоколы контроллеры, которые позволяет взаемодействвоать с приложением.
- провайдеры. Это различные сервисы, репозитории баз данных и другие провайдеры, которые могут быть задаными.
- экспортс. Это то, что будет экспортировано. Это могут быть или провайдеры, которые будут переиспользоватся в других модулях или это реэкспорт других модулей, которые он в себя импортирует. 

Это всё хранится в декораторах, поскольку когда приложение запускается, оно начинает строить дерево зависимостей идя от корневого модуля, он собирает все импорты, провайдеры и контроллеры и строит это дерево. 

#### Использование модулей

**Первый способ - общие модули**

Общие модули можно импортировать в различные модули.

[![image.jpg](https://i.postimg.cc/43CQ7cJy/image.jpg)](https://postimg.cc/Yv3WThLB)

**Второй способ - повторный экспорт модулей**

Это когда модуль используйщийся промежуточным модулем используется ниже

[![image.jpg](https://i.postimg.cc/tJPxHSxz/image.jpg)](https://postimg.cc/sGjXYJKB)

**Третий способ - глобальные модули**

Такое может быть необходимо тогда, когда есть модуль, который необходимо использовать во всех модулях приложения. К примеру если используется подключение в базе данных во всех модулях, то можно задать модуль работы базы данных как глобальный и использовать репозиторий базы данных везде без дополнительного импорта модулей. Единственное это то, что глобальный модуль должен быть импортирован в корневой модуль. 

[![image.jpg](https://i.postimg.cc/bYBPXYyL/image.jpg)](https://postimg.cc/7b0d0kTT)

**Четвертый способ - динамические модули**

Часто, особенно при работе с базой данных, необходимо не только получить модуль базы данных, но и передать туда какую-то информацию о подключениях, пользователях и т.п., тогда необходимо использовать динамические модули. Динамические модули - это статический метод модуля, который, в результате, возвращает модуль с вложением провайдера, экспорта и импорта. По умолчанию их необходимо называть `forRoot`, если это глобальный или же `forFeature` если этот модуль использоватся в определенном скоупе модулей. 

[![image.jpg](https://i.postimg.cc/VsBt4TzY/image.jpg)](https://postimg.cc/V5v5kKST)

